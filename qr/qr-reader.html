<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>QR Scanner with History</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- ‡πÇ‡∏´‡∏•‡∏î jsQR ‡∏à‡∏≤‡∏Å CDN ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ñ‡∏≠‡∏î‡∏£‡∏´‡∏±‡∏™ QR Code -->
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>

    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #f3f4f6;
            margin: 0;
            padding: 16px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #fff;
            border-radius: 12px;
            padding: 16px 20px 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }
        h1 {
            font-size: 1.4rem;
            margin: 0 0 10px;
        }
        p.subtitle {
            margin: 0 0 16px;
            color: #6b7280;
            font-size: 0.9rem;
        }
        .btn-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }
        button {
            border: none;
            border-radius: 8px;
            padding: 8px 14px;
            font-size: 0.9rem;
            cursor: pointer;
            background: #2563eb;
            color: white;
        }
        button.secondary {
            background: #6b7280;
        }
        button.danger {
            background: #dc2626;
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        #video-container {
            margin-top: 10px;
            display: none;
        }
        video {
            width: 100%;
            max-height: 300px;
            border-radius: 8px;
            background: #000;
        }
        .history-section {
            margin-top: 20px;
        }
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        .history-header h2 {
            font-size: 1.1rem;
            margin: 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        th, td {
            border-bottom: 1px solid #e5e7eb;
            padding: 6px 4px;
            text-align: left;
            vertical-align: top;
        }
        th {
            background: #f9fafb;
            font-weight: 600;
        }
        td pre {
            margin: 0;
            white-space: pre-wrap;
            word-break: break-all;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        }
        .chip {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 999px;
            font-size: 0.7rem;
            background: #e5e7eb;
            color: #374151;
        }
        .chip.camera {
            background: #dbeafe;
            color: #1d4ed8;
        }
        .chip.image {
            background: #fef3c7;
            color: #b45309;
        }
        .small-btn {
            font-size: 0.75rem;
            padding: 4px 8px;
            margin-right: 4px;
        }
        #status {
            font-size: 0.8rem;
            color: #6b7280;
            margin-top: 6px;
        }
        @media (max-width: 600px) {
            th:nth-child(1), td:nth-child(1) {
                width: 40px;
            }
            th:nth-child(4), td:nth-child(4) {
                width: 130px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡πÅ‡∏Å‡∏ô / ‡∏≠‡πà‡∏≤‡∏ô QR Code + ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ (Local JSON)</h1>
    <p class="subtitle">
        - ‡∏õ‡∏∏‡πà‡∏° <b>‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á</b> ‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô HTTPS ‡πÄ‡∏ä‡πà‡∏ô GitHub Pages)<br>
        - ‡∏õ‡∏∏‡πà‡∏° <b>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</b> ‡∏≠‡πà‡∏≤‡∏ô QR ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û<br>
        ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏à‡∏≠‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÉ‡∏ô <code>localStorage</code>
    </p>

    <div class="btn-row">
        <button id="startCameraBtn">üì∑ ‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
        <button id="stopCameraBtn" class="secondary" disabled>‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>

        <button id="selectImageBtn">üñºÔ∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</button>
        <input type="file" id="fileInput" accept="image/*" style="display:none">

        <span id="status"></span>
    </div>

    <div id="video-container">
        <video id="video" playsinline></video>
    </div>

    <!-- canvas ‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏†‡∏≤‡∏û (‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ) -->
    <canvas id="canvas" style="display:none;"></canvas>

    <div class="history-section">
        <div class="history-header">
            <h2>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô</h2>
            <div>
                <button id="refreshHistoryBtn" class="secondary small-btn">üîÑ ‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
                <button id="clearHistoryBtn" class="danger small-btn">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            </div>
        </div>

        <table>
            <thead>
            <tr>
                <th>#</th>
                <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
                <th>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ</th>
                <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó / ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
            </thead>
            <tbody id="historyBody">
            <tr><td colspan="4" style="text-align:center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    // ======== ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏´‡∏•‡∏±‡∏Å ========
    const startCameraBtn = document.getElementById('startCameraBtn');
    const stopCameraBtn  = document.getElementById('stopCameraBtn');
    const selectImageBtn = document.getElementById('selectImageBtn');
    const fileInput      = document.getElementById('fileInput');
    const video          = document.getElementById('video');
    const videoContainer = document.getElementById('video-container');
    const canvas         = document.getElementById('canvas');
    const ctx            = canvas.getContext('2d');
    const historyBody    = document.getElementById('historyBody');
    const clearHistoryBtn= document.getElementById('clearHistoryBtn');
    const refreshHistoryBtn = document.getElementById('refreshHistoryBtn');
    const statusSpan     = document.getElementById('status');

    const STORAGE_KEY = 'qrScanHistory';

    let historyData = [];
    let scanning = false;
    let videoStream = null;

    // ======== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Utility ========

    function setStatus(msg) {
        statusSpan.textContent = msg || '';
    }

    function escapeHtml(str) {
        return str
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }

    function loadHistory() {
        try {
            const raw = localStorage.getItem(STORAGE_KEY);
            historyData = raw ? JSON.parse(raw) : [];
        } catch (e) {
            console.error('Error loading history', e);
            historyData = [];
        }
        renderHistory();
    }

    function saveHistory() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(historyData));
    }

    function renderHistory() {
        historyBody.innerHTML = '';

        if (!historyData.length) {
            historyBody.innerHTML =
                '<tr><td colspan="4" style="text-align:center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô</td></tr>';
            return;
        }

        historyData.forEach((item, index) => {
            const tr = document.createElement('tr');

            const date = new Date(item.time);
            const timeText = isNaN(date.getTime())
                ? escapeHtml(item.time)
                : date.toLocaleString();

            let chipClass = 'chip';
            if (item.source === 'camera') chipClass += ' camera';
            if (item.source === 'image')  chipClass += ' image';

            tr.innerHTML = `
                <td>${index + 1}</td>
                <td>${escapeHtml(timeText)}</td>
                <td><pre>${escapeHtml(item.text)}</pre></td>
                <td>
                    <div style="margin-bottom:4px;">
                        <span class="${chipClass}">
                            ${item.source === 'camera' ? '‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á' : '‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ'}
                        </span>
                    </div>
                    <button class="small-btn open-btn" data-index="${index}">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà</button>
                    <button class="small-btn secondary copy-btn" data-index="${index}">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
                </td>
            `;
            historyBody.appendChild(tr);
        });
    }

    function addHistory(text, source) {
        const item = {
            text: text,
            time: new Date().toISOString(),
            source: source || 'unknown'
        };
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏™‡∏∏‡∏î
        historyData.unshift(item);
        saveHistory();
        renderHistory();
    }

    // ======== ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡πâ‡∏≠‡∏á ========

    async function startCamera() {
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            alert('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á');
            return;
        }

        try {
            setStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á...');
            const stream = await navigator.mediaDevices.getUserMedia({
                video: { facingMode: 'environment' }
            });

            videoStream = stream;
            video.srcObject = stream;
            video.setAttribute('playsinline', true); // ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö iOS
            videoContainer.style.display = 'block';
            await video.play();

            scanning = true;
            startCameraBtn.disabled = true;
            stopCameraBtn.disabled = false;
            setStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πÅ‡∏Å‡∏ô... ‡∏ô‡∏≥ QR Code ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á');

            requestAnimationFrame(tickScan);
        } catch (err) {
            console.error(err);
            alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ: ' + err.message);
            setStatus('');
        }
    }

    function stopCamera() {
        scanning = false;
        if (videoStream) {
            videoStream.getTracks().forEach(track => track.stop());
            videoStream = null;
        }
        video.srcObject = null;
        videoContainer.style.display = 'none';
        startCameraBtn.disabled = false;
        stopCameraBtn.disabled = true;
        setStatus('');
    }

    function tickScan() {
        if (!scanning) return;

        if (video.readyState === video.HAVE_ENOUGH_DATA) {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const code = jsQR(imageData.data, imageData.width, imageData.height);

            if (code) {
                // ‡πÄ‡∏à‡∏≠ QR ‡πÅ‡∏•‡πâ‡∏ß ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
                scanning = false;
                stopCamera();
                handleScanResult(code.data, 'camera');
                return;
            }
        }

        requestAnimationFrame(tickScan);
    }

    // ======== ‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏†‡∏≤‡∏û ========

    function scanFromFile(file) {
        if (!file) return;

        const img = new Image();
        img.onload = function () {
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const code = jsQR(imageData.data, imageData.width, imageData.height);

            if (code) {
                handleScanResult(code.data, 'image');
            } else {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö QR Code ‡πÉ‡∏ô‡∏†‡∏≤‡∏û‡∏ô‡∏µ‡πâ');
            }

            // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÑ‡∏ü‡∏•‡πå input ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏û‡πÄ‡∏î‡∏¥‡∏°‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
            fileInput.value = '';
        };
        img.onerror = function () {
            alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ');
            fileInput.value = '';
        };

        img.src = URL.createObjectURL(file);
    }

    // ======== ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ ========

    function handleScanResult(text, source) {
        const trimmed = (text || '').trim();
        if (!trimmed) {
            alert('‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å QR ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ');
            return;
        }

        addHistory(trimmed, source);

        // ‡∏ñ‡πâ‡∏≤‡∏î‡∏π‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà
        // (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏à‡∏£‡∏¥‡∏á ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß error ‡πÄ‡∏≠‡∏á)
        const looksLikeUrl =
            /^https?:\/\//i.test(trimmed) ||
            /^www\./i.test(trimmed);

        const target = looksLikeUrl ? trimmed : ('https://www.google.com/search?q=' + encodeURIComponent(trimmed));

        try {
            const opened = window.open(target, '_blank');
            if (!opened) {
                alert('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏õ‡πá‡∏≠‡∏õ‡∏≠‡∏±‡∏õ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏≠‡∏á');
            }
        } catch (e) {
            console.error(e);
            alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏î‡πâ: ' + e.message);
        }
    }

    // ======== Event Listeners ========

    startCameraBtn.addEventListener('click', startCamera);
    stopCameraBtn.addEventListener('click', stopCamera);

    selectImageBtn.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            setStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≤‡∏ô‡∏†‡∏≤‡∏û...');
            scanFromFile(file);
            setStatus('');
        }
    });

    clearHistoryBtn.addEventListener('click', () => {
        if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
        historyData = [];
        localStorage.removeItem(STORAGE_KEY);
        renderHistory();
    });

    refreshHistoryBtn.addEventListener('click', () => {
        loadHistory();
    });

    // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ (‡πÄ‡∏õ‡∏¥‡∏î / ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å)
    historyBody.addEventListener('click', async (e) => {
        const btn = e.target;
        if (!(btn instanceof HTMLButtonElement)) return;

        const index = parseInt(btn.dataset.index, 10);
        if (isNaN(index) || index < 0 || index >= historyData.length) return;

        const item = historyData[index];

        if (btn.classList.contains('open-btn')) {
            // ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà
            let target = item.text;
            if (!/^https?:\/\//i.test(target) && !/^www\./i.test(target)) {
                target = 'https://www.google.com/search?q=' + encodeURIComponent(target);
            }
            window.open(target, '_blank');
        } else if (btn.classList.contains('copy-btn')) {
            try {
                await navigator.clipboard.writeText(item.text);
                alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏•‡πâ‡∏ß');
            } catch (err) {
                alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + err.message);
            }
        }
    });

    // ======== ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ ========
    loadHistory();
</script>
</body>
</html>